# 天穹安防系统 - 运维指南

## 系统架构

### 前端架构
- **静态文件**: 位于`web`目录
  - HTML页面
  - JavaScript脚本
  - CSS样式表
- **核心文件**:
  - `app.js`: 主应用逻辑
  - `performance_monitor.js`: 性能监控模块
  - `bg.js`: 背景处理
  - `ids/`: 入侵检测系统模块
  - `test/`: 测试框架

### 后端交互
- 通过RESTful API与后端服务通信
- 支持代理设置配置
- 身份验证通过JWT token管理

## 部署指南

### 开发环境部署

1. **环境准备**
   ```bash
   # 克隆项目
   git clone [repository-url]
   cd xuan-guang-security-gpt
   
   # 安装依赖(如果需要)
   npm install
   
   # 启动开发服务器
   npm run dev
   # 或使用Python简单HTTP服务器
   cd web
   python -m http.server 8000
   ```

2. **访问方式**
   - 浏览器打开: `http://localhost:8000`

### 生产环境部署

1. **Nginx部署示例**
   ```nginx
   server {
       listen 80;
       server_name security.yourdomain.com;
       
       # 重定向到HTTPS
       return 301 https://$host$request_uri;
   }
   
   server {
       listen 443 ssl;
       server_name security.yourdomain.com;
       
       # SSL配置
       ssl_certificate /path/to/ssl/cert.pem;
       ssl_certificate_key /path/to/ssl/key.pem;
       
       # 静态文件目录
       root /path/to/xuan-guang-security-gpt/web;
       index index.html;
       
       # API代理
       location /api/ {
           proxy_pass http://backend-server:8000/api/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       # 缓存控制
       location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
           expires 1d;
           add_header Cache-Control "public, max-age=86400";
       }
   }
   ```

2. **Docker部署**
   创建Dockerfile:
   ```dockerfile
   FROM nginx:alpine
   
   COPY web/ /usr/share/nginx/html/
   COPY nginx.conf /etc/nginx/conf.d/default.conf
   
   EXPOSE 80
   ```

   构建和运行:
   ```bash
   docker build -t xuan-guang-security .
   docker run -d -p 80:80 xuan-guang-security
   ```

## 配置管理

### 系统配置

1. **Web界面配置**
   - 访问 `/config` 页面
   - 配置项包括:
     - API密钥和基础URL
     - 扫描参数(并发数、超时时间)
     - IP黑名单设置
     - 代理服务器配置

2. **本地存储配置**
   - 使用localStorage存储用户配置
   - 关键配置包括:
     - 用户认证信息
     - 代理配置
     - 性能模式设置

3. **环境变量(可选)**
   - 可在部署环境中设置环境变量覆盖默认配置
   - 示例:
     ```
     API_BASE_URL=https://api.yourdomain.com
     DEFAULT_PROXY_ENABLED=false
     ```

### 安全配置最佳实践

1. **内容安全策略(CSP)**
   - 系统默认启用CSP
   - 如需调整，修改index.html中的CSP头

2. **XSS保护**
   - 默认启用X-XSS-Protection
   - 确保所有用户输入经过验证和转义

3. **HTTPS配置**
   - 生产环境必须启用HTTPS
   - 配置HSTS以强制使用HTTPS

## 性能监控与优化

### 监控工具

1. **内置性能监控**
   - 系统集成了`performance_monitor.js`模块
   - 监控指标包括:
     - 网络请求性能
     - 内存使用情况
     - 渲染性能

2. **性能数据访问**
   - 通过`performanceMonitor.getPerformanceReport()`获取性能报告
   - 性能警报会通过toast提示展示

### 优化建议

1. **网络优化**
   - 系统已实现请求缓存机制
   - 推荐启用HTTP/2以提高加载速度

2. **内存优化**
   - 监控内存使用，超过200MB会触发警报
   - 定期清理缓存和未使用资源

3. **渲染优化**
   - 减少不必要的DOM操作
   - 优化动画性能，确保60fps流畅体验

## 日志管理

### 日志类型

1. **系统日志**
   - 记录在浏览器控制台
   - 关键事件包括:
     - 系统启动和初始化
     - 配置加载
     - 错误和异常

2. **安全日志**
   - 记录安全相关事件
   - 包括登录尝试、安全审计结果、威胁检测等

3. **用户操作日志**
   - 记录用户关键操作
   - 用于审计和故障排查

### 日志分析

1. **浏览器控制台分析**
   - 开发和调试使用
   - 可按级别过滤(log, warn, error)

2. **服务端日志集成**
   - 生产环境建议配置将前端日志发送到后端
   - 可使用ELK Stack等工具进行日志聚合和分析

## 故障排除

### 常见问题与解决方案

1. **登录问题**
   - **症状**: 无法登录系统
   - **排查步骤**:
     - 检查网络连接
     - 验证用户名和密码
     - 检查token是否过期
     - 查看控制台错误日志

2. **API连接失败**
   - **症状**: 功能无法正常使用，显示API错误
   - **排查步骤**:
     - 检查API基础URL配置
     - 验证API密钥有效性
     - 检查网络连接和代理设置
     - 确认CORS配置正确

3. **性能问题**
   - **症状**: 系统响应缓慢
   - **排查步骤**:
     - 查看性能监控报告
     - 检查内存使用情况
     - 分析网络请求耗时
     - 检查是否有大量并发请求

4. **安全扫描失败**
   - **症状**: 扫描任务未完成或报错
   - **排查步骤**:
     - 检查扫描参数设置
     - 验证目标是否可达
     - 检查系统资源使用情况
     - 查看详细错误日志

### 紧急恢复流程

1. **备份恢复**
   - 定期备份重要配置和数据
   - 恢复步骤:
     - 停止当前服务
     - 恢复备份文件
     - 重启服务

2. **降级方案**
   - 如遇严重问题，可启用降级模式:
     - 减少并发扫描任务
     - 禁用非核心功能
     - 增加缓存时间

## 定期维护计划

### 日常维护

1. **监控检查**
   - 检查系统性能指标
   - 审查安全日志和警报

2. **备份确认**
   - 确认关键数据已备份
   - 验证备份完整性

### 每周维护

1. **安全更新**
   - 检查并应用安全更新
   - 更新威胁情报和病毒库

2. **性能优化**
   - 清理临时文件和缓存
   - 优化配置参数

### 每月维护

1. **全面审计**
   - 执行完整安全审计
   - 审查用户权限和访问记录

2. **系统评估**
   - 评估系统性能和容量
   - 规划必要的升级和扩展

## 升级指南

### 版本更新流程

1. **备份**
   - 备份当前系统配置
   - 备份重要数据

2. **更新部署**
   - 下载最新版本
   - 停止当前服务
   - 替换文件
   - 启动服务

3. **验证**
   - 检查功能完整性
   - 验证数据和配置

### 注意事项

- 升级前查看版本变更日志
- 部分更新可能需要配置迁移
- 升级后建议执行全面测试

## 安全最佳实践

1. **定期安全审计**
   - 系统已实现自动安全审计功能
   - 建议配合手动审计和渗透测试

2. **访问控制**
   - 严格控制管理员访问权限
   - 实施最小权限原则

3. **数据保护**
   - 敏感数据传输必须使用HTTPS
   - 定期加密备份

4. **应急响应准备**
   - 制定安全事件响应计划
   - 定期演练应急响应流程

## 联系与支持

- **技术支持**: [support@example.com]
- **紧急联系人**: [emergency@example.com]
- **文档更新**: [docs@example.com]

---

*本文档由天穹安防系统运维团队编写，最后更新时间: 2023年12月*